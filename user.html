<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Utilisateur - TÃ¢ches</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h1>ğŸ¯ TÃ¢ches disponibles</h1>
  <ul id="taskList"></ul>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDY4HHyrghswpcgfyMyMA9OWDbWJeWyKMg",
      authDomain: "xbetru-f3506.firebaseapp.com",
      databaseURL: "https://xbetru-f3506-default-rtdb.firebaseio.com",
      projectId: "xbetru-f3506",
      storageBucket: "xbetru-f3506.firebasestorage.app",
      messagingSenderId: "589096414662",
      appId: "1:589096414662:web:d8f1e1e3b5bb18de3b96c7",
      measurementId: "G-74XYP10RNY"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const userId = prompt("Entrez votre ID Telegram :");

    // Afficher les tÃ¢ches
    db.collection("tasks").onSnapshot(snapshot => {
      const taskList = document.getElementById("taskList");
      taskList.innerHTML = "";
      snapshot.forEach(doc => {
        const task = doc.data();
        const li = document.createElement("li");
        li.innerHTML = `
          ${task.title} (${task.reward} points)
          <a href="${task.url}" target="_blank">Faire la tÃ¢che</a>
          <button onclick="valider('${doc.id}', ${task.reward})">Valider</button>
        `;
        taskList.appendChild(li);
      });
    });

    // Valider la tÃ¢che
    function valider(taskId, reward) {
      fetch(`/api/verifyTask?userId=${userId}&taskId=${taskId}&reward=${reward}`)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert("âœ… TÃ¢che validÃ©e et rÃ©compense ajoutÃ©e !");
          } else {
            alert("âŒ Vous devez d'abord rejoindre le canal !");
          }
        });
    }
  </script>
</body>
</html>
